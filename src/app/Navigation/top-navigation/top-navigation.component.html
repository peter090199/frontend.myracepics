<mat-progress-bar *ngIf="isLoading" mode="indeterminate" color="primary"></mat-progress-bar>

<div class="app-container">
  <mat-toolbar class="header">
    <div *ngIf="isMobile" class="logo">
      <img src="assets/images/logo.png" alt="logo" style="height:24px;">
    </div>
  
  <!--MOBILE -->
    <div *ngIf="isMobile">
     
      <div class="space-gap">

          <div *ngFor="let link of nav_module" [ngClass]="{'dropdown': link.submenus && link.submenus.length > 0}" >
           
            <div *ngIf="link.submenus && link.submenus.length > 0; else regularLink"  >
              <button mat-icon-button [matMenuTriggerFor]="menu"  style="color: rgb(255, 254, 254);">
                <i class="{{ link.icon }}"></i>
              </button>
              

              <mat-menu #menu="matMenu">
                <button mat-menu-item *ngFor="let submenu of link.submenus" [routerLink]="[submenu.route]" style="color: black;">
                  {{submenu.description}}
                </button>

                <button mat-menu-item mat-button (click)="onLogout()" *ngIf="link.description == 'Profile'">
                  Logout
                </button>
                
              </mat-menu>
            </div>
          
              <ng-template #regularLink>
                 <button 
                    mat-icon-button 
                    [routerLink]="[link.route]" 
                    *ngIf="link.description !== 'Notifications' && link.description !== 'Messaging' && link.description !== 'Profile'">
                    <i class="{{ link.icon }}"></i> 
                 </button>
              

                  <button mat-icon-button *ngIf="link.description === 'Messaging'" 
                  [routerLink]="[link.route]" matBadge="{{ unreadCount }}" matBadgeColor="warn" [matBadgeHidden]="unreadCount === 0">
                  
                  <i class="{{ link.icon }}"></i>
                </button>

                <button mat-icon-button 
                      *ngIf="link.description === 'Notifications'" 
                      matTooltip="View Notification" 
                      (click)="openNotifications()" 
                      [matBadge]="unreadCount" [matBadgeHidden]="unreadCount === 0" 
                      matBadgeColor="warn">
                <mat-icon>notifications</mat-icon>
              </button>


              </ng-template>
            </div>
                      
            <button mat-icon-button class="search-icon-btn" (click)="toggleSearch()" *ngIf="!isSearchOpen">
              <mat-icon>search</mat-icon>
            </button>
            
            <div *ngIf="isSearchOpen" class="search-overlay">
              <div *ngIf="isMobile">
                <app-search></app-search>
              </div>
              <button mat-icon-button class="close-btn" (click)="toggleSearch()">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            
               
             <!-- <button mat-icon-button (click)="onLogout()">
                <mat-icon>logout</mat-icon>
             </button> -->

              <button class="navbar-toggler" type="button" (click)="toggleSidebar()" aria-label="Toggle navigation" *ngIf="isMobile">
                <mat-icon>{{ isSidebarOpen ? 'close' : 'menu' }}</mat-icon>
              </button>

        </div>
    </div>




  <!-- DESKTOP -->
  <div class="logo" *ngIf="!isMobile">
    <img src="assets/images/logo.png" alt="logo" style="height:24px;">exsuz
  </div>
    <nav *ngIf="!isMobile" class="nav" >
        <div class="fb-header-left" *ngIf="!isMobile">
          <app-search></app-search>
        </div>

            <!-- menus with submenus -->
            <div *ngFor="let link of nav_module" [ngClass]="{'dropdown': link.submenus && link.submenus.length > 0}">
              <!-- Dropdown Menu -->
               
              <div *ngIf="link.submenus && link.submenus.length > 0; else regularLink">
                <button mat-button [matMenuTriggerFor]="menu"  style="color: rgb(255, 254, 254);">
                  <i class="{{ link.icon }}"></i> {{ link.description }}
                </button>
                
                <mat-menu  #menu="matMenu">
                  <button mat-menu-item *ngFor="let submenu of link.submenus" [routerLink]="[submenu.route]" style="color: black;">
                    {{ submenu.description }}
                  </button>
                
                </mat-menu>
              </div>
            
              <!-- Regular Link with Notification Badge -->
              <ng-template #regularLink>
                <button 
                mat-button  [routerLink]="[link.route]"
                *ngIf="link.description == 'Notifications' && link.description == 'Messaging'"
                (click)="link.description === 'Home' ? onHomeClick() : null"
                style="cursor: pointer;"
                [matBadge]="link.description === 'Home' && homeNewDataCount > 0 ? homeNewDataCount : null"
                matBadgeColor="warn"
                [matBadgeHidden]="!(link.description === 'Home' && homeNewDataCount > 0)"
              >
                <i class="{{ link.icon }}"></i> {{ link.description }}
              </button>


                <button mat-button [routerLink]="[link.route]" *ngIf="link.description !== 'Notifications' && link.description !== 'Messaging'">
                  <i class="{{ link.icon }}"></i> {{ link.description }}
                </button>

                <button mat-icon-button *ngIf="link.description === 'Messaging'" 
                  [routerLink]="[link.route]" matBadge="{{ unreadCount }}" matBadgeColor="warn" [matBadgeHidden]="unreadCount === 0">
                  <i class="{{ link.icon }}"></i>
                </button>

                <!-- <button 
                      mat-button
                      [matBadge]="link.description === 'Home' && homeNewDataCount > 0 ? homeNewDataCount : null"
                      matBadgeColor="warn"
                      [matBadgeHidden]="!(link.description === 'Home' && homeNewDataCount > 0)"
                    >
                    <i class="{{ link.icon }}"></i> {{ link.description }}
               </button> -->
              

                <button mat-icon-button 
                      *ngIf="link.description === 'Notifications'" 
                      matTooltip="View Notification" 
                      (click)="openNotifications()" 
                      [matBadge]="unreadCount" [matBadgeHidden]="unreadCount === 0" 
                      matBadgeColor="warn">
                <mat-icon>notifications</mat-icon>
              </button>
              </ng-template>

               
            </div>
            
            <button mat-icon-button (click)="onLogout()">
             <mat-icon>logout</mat-icon>
            </button>
    </nav>


    

    
  </mat-toolbar>

  <!-- Sidebar for mobile -->
  <div class="sidebar" [ngClass]="{'active': isSidebarOpen}">
    <div class="sidebar-header">
      <div class="logo">
        <img src="assets/images/logo.png" alt="logo" style="height:20px;">
        exsuz
      </div>
    </div>

       <!-- menus with submenus -->
    <ul class="list-unstyled" *ngFor="let link of nav_module" class="nav-item" [ngClass]="{'dropdown': link.submenus && link.submenus.length > 0}">
      <div *ngIf="link.submenus && link.submenus.length > 0; else regularLink">
        <button mat-button [matMenuTriggerFor]="menu" class="nav-link">{{ link.description }}</button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item *ngFor="let submenu of link.submenus" [routerLink]="[submenu.route]">
            <i class="{{ link.icon }}"></i> {{ link.description }}
          </button>
        </mat-menu>
      </div>
      <ng-template #regularLink>
        <button mat-button class="nav-link" [routerLink]="[link.route]">
          <i class="{{ link.icon }}"></i> {{ link.description }}
        </button>
      </ng-template>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="container-fixed">
    <router-outlet></router-outlet>
  </div>

    <!-- <app-footer></app-footer> -->

</div>
