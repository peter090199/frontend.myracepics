<!-- Progress bar shown only while uploading -->
<mat-progress-bar *ngIf="isUploading" mode="indeterminate" color="primary">
</mat-progress-bar>


<form [formGroup]="postForm" class="form-container">
  <div class="profile-info">
    <div class="profile-name">
      <img
        [src]="getProfileImage(profiles?.photo_pic)"
        alt="Profile Picture"
        class="profile-img"
      />
      <mat-form-field appearance="standard" class="status-dropdown">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status" required>
          <mat-option value="" disabled selected>Select Status</mat-option>
          <mat-option *ngFor="let option of statusOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <span class="post-status" *ngIf="profiles2">
      Create Post to {{ getSelectedStatus() }} {{ profiles2.fname }}
    </span>
  </div>

  <mat-dialog-content class="post-content">
    <mat-form-field appearance="outline" class="full-width">
      <textarea matInput placeholder="What do you want to talk about?" formControlName="caption" required></textarea>
      <mat-error *ngIf="postForm.get('caption')?.hasError('required')">
        Post is required.
      </mat-error>
    </mat-form-field>

    <div class="form-row">
      <button mat-icon-button (click)="uploadImage()" class="form-field">
        <mat-icon>image</mat-icon>
      </button>

      <!-- Hidden File Input for Video -->
      <input type="file" accept="video/mp4" #videoInput style="display: none"
        (change)="onVideoSelected($event)" />

      <!-- Trigger video input -->
      <button mat-icon-button class="form-field" (click)="videoInput.click()">
        <mat-icon>videocam</mat-icon>
      </button>

      <button mat-icon-button class="form-field">
        <mat-icon>settings</mat-icon>
      </button>
    </div>
  </mat-dialog-content>

  <!-- Video preview -->
  <div class="video-player-container" *ngIf="videoPreviewUrl">
    <video #videoPlayer (timeupdate)="updateProgress(videoPlayer)" (pause)="onPause()"
      (play)="onPlay()" (ended)="onPause()">
      <source [src]="videoPreviewUrl" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    <button class="overlay-btn" *ngIf="!isPlaying" (click)="toggleVideo(videoPlayer)">
      <mat-icon>play_arrow</mat-icon>
    </button>

    <div class="controls">
      <button (click)="toggleVideo(videoPlayer)">
        <mat-icon>{{ isPlaying ? 'pause' : 'play_arrow' }}</mat-icon>
      </button>

      <input type="range" min="0" [max]="videoPlayer.duration || 0" [value]="currentTime"
        (input)="seekVideo(videoPlayer, $event)" />

      <span>{{ formatTime(currentTime) }} / {{ formatTime(videoPlayer.duration) }}</span>

      <button (click)="toggleFullscreen(videoPlayer)">
        <mat-icon>fullscreen</mat-icon>
      </button>
    </div>
  </div>


</form>
  <mat-card-footer align="end">
    <button mat-button (click)="closeDialog()">Cancel</button>
    <button mat-flat-button color="primary" [disabled]="postForm.invalid || isUploading" (click)="postData()">
      Post
    </button>
  </mat-card-footer>