<div class="section">
  <!-- Cover Photo -->
  <div class="cover-photo-container">
    <img [src]="profiles?.coverphoto" alt="Cover Photo" class="cover-photo-img" />
  </div>

  <!-- Profile Info -->
  <div *ngIf="!isloading; else profileSkeleton" class="profile-details">
    <div class="profile-info" *ngIf="userprofiles">
      <div class="profile-picture">
        <div class="avatar-container">
          <img class="profile-img" [src]="userprofiles?.photo_pic || 'assets/images/default.png'" alt="Profile" />
          <mat-icon class="status-icon online">circle</mat-icon>
        </div>
      </div>
      <h1>{{ profiles.fullname }}
        <small>{{ profiles.current_location }}</small>
      </h1>
      <p>{{ profiles.followers }} followers · {{ profiles.following }} following</p>

      <div class="button-gap">
        <button mat-flat-button
          [color]="followStatus === 'accepted' ? 'accent' : followStatus === 'pending' ? 'warn' : 'primary'"
          *ngIf="currentUserCode !== ownCode"
          (click)="AddFollow(currentUserCode, followStatus, profiles.fname, profiles.lname)">
          <mat-icon *ngIf="followStatus === 'none' || followStatus === 'cancelled'">person_add</mat-icon>
          <mat-icon *ngIf="followStatus === 'pending'" class="hourglass-animated">hourglass_top</mat-icon>
          <mat-icon *ngIf="followStatus === 'accepted'">check_circle</mat-icon>

          <ng-container [ngSwitch]="followStatus">
            <span *ngSwitchCase="'none'">Connect</span>
            <span *ngSwitchCase="'pending'">Pending</span>
            <span *ngSwitchCase="'accepted'">Connected</span>
            <span *ngSwitchCase="'cancelled'">Connect</span>
          </ng-container>
        </button>
      </div>
    </div>
  </div>

  <ng-template #profileSkeleton>
    <div class="profile-skeleton">
      <div class="skeleton skeleton-avatar"></div>
      <div class="skeleton skeleton-text" style="width:40%"></div>
      <div class="skeleton skeleton-text" style="width:20%"></div>
    </div>
  </ng-template>

  <!-- Tabs -->
  <mat-tab-group class="tabs-container">

    <!-- Home Tab -->
    <mat-tab label="Home">
      <div *ngIf="isloading">
        <mat-card class="post-box-container" *ngFor="let s of skeletonPosts">
          <mat-card-header>
            <div class="skeleton skeleton-avatar"></div>
            <div class="skeleton skeleton-text" style="width: 50%"></div>
          </mat-card-header>
          <div class="skeleton skeleton-img"></div>
          <div class="skeleton skeleton-text"></div>
          <div class="skeleton skeleton-text" style="width: 70%"></div>
        </mat-card>
      </div>

      <!-- Company Profile Home -->
      <mat-card class="post-box-container" *ngIf="profiles">
        <div class="cover-photo">
          <img [src]="profiles.coverPhoto || 'assets/images/default.png'" alt="Company Cover">
        </div>

        <div class="company-header">
          <img class="company-logo" [src]="profiles.logo || 'assets/images/default.png'" alt="Company Logo">
          <div class="company-info">
            <h1>{{ profiles.fullname }} <small>{{ profiles.profession }}</small></h1>
            <p>{{ profiles.industry }} · {{ profiles.companysize }} employees</p>
            <a [href]="profiles.companywebsite" target="_blank">{{ profiles.companywebsite }}</a>
          </div>
        </div>

        <mat-divider></mat-divider>
        <div class="about-section">
          <h3>About</h3>
          <p>{{ profiles.about || 'No company description available.' }}</p>
        </div>

        <mat-divider></mat-divider>
        <div class="location-section">
          <h3>Headquarters</h3>
          <p>{{ profiles.current_location || 'Location not provided' }}</p>
        </div>
      </mat-card>
    </mat-tab>

    <!-- Post Tab -->
    <mat-tab label="Post">
      <div class="feed-container" *ngIf="!isloading">
        <div *ngFor="let post of posts; let i = index; trackBy: trackByPostId" class="post-card">
          <div class="post-header">
            <div mat-card-avatar class="avatar">
            <img [src]="post.profile_pic || 'assets/images/default.png'" alt="Avatar" />
          </div>
          
            <div class="user-info">
              <a class="user-name">{{ post.Fullname }}</a>
              <span class="post-time">{{ post.created_at | date:'medium' }}</span>
            </div>
          </div>

          <!-- Caption -->
          <div class="post-caption">
            <p>{{ post.expanded ? post.caption : (post.caption | slice:0:800) + (post.caption.length > 800 ? '...' : '')
              }}</p>
            <a *ngIf="post.caption.length > 900" (click)="post.expanded = !post.expanded" class="see-more">
              {{ post.expanded ? 'See Less' : 'See More' }}
            </a>
          </div>

          <!-- Images -->
          <div *ngIf="post.images?.length > 0" class="post-media">
            <div class="gallery" [ngClass]="{ single: post.images.length === 1, multi: post.images.length > 1 }">
              <div class="gallery-item" *ngFor="let image of post.images.slice(0, maxImages); let j = index"
                (click)="openModal(post.images)">
                <img [src]="image.path_url" alt="Post image" />
                <div class="overlay" *ngIf="j === maxImages - 1 && post.images.length > maxImages">
                  +{{ post.images.length - maxImages }}
                </div>
              </div>
            </div>
          </div>

          <!-- Videos -->
          <div *ngIf="post.videos?.length > 0" class="video-gallery">
            <video *ngFor="let video of post.videos.slice(0, maxImages)" controls [src]="video.path_url"></video>
          </div>

          <!-- Reactions -->
          <div class="reactions-summary"
            *ngIf="postReactions[post.id]?.reactions?.length || postReactions[post.id]?.totalCount">
            <div class="emoji-stack" style="position: relative; height: 24px;">
              <ng-container *ngFor="let reaction of postReactions[post.id].reactions; let i = index">
                <span class="emoji-item" [ngStyle]="{
                'position': 'absolute',
                'z-index': postReactions[post.id].reactions.length - i,
                'left.px': i * 15
              }">
                  {{ reaction.emoji }}
                </span>
              </ng-container>
            </div>

            <a *ngIf="postReactions[post.id]?.totalCount" class="reaction-count-text"
              (mouseenter)="showHoverNames(post.id, $event)" (mouseleave)="hideHoverNames()"
              (click)="openReactionsModal(post.id)"
              [ngStyle]="{'margin-left.px': 17 * postReactions[post.id].totalCount, 'cursor': 'pointer'}">
              {{ postReactions[post.id].totalCount }}
            </a>

            <div *ngIf="hoverVisible && hoveredPostId === post.id" class="reaction-tooltip"
              [ngStyle]="{'top.px': hoverPosition.y, 'left.px': hoverPosition.x}">

              <div *ngFor="let reaction of hoveredReactions2">
                <div *ngFor="let person of reaction.person" class="reaction-user">
                  <span>{{ person.fullname }}</span>
                </div>
                <div *ngIf="reaction.person.length > 11" class="reaction-more">
                  +{{ reaction.person.length - 11 }} more
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Buttons -->
        <div class="post-footer">
          <div class="footer-btn like-button-wrapper" (mouseenter)="showReaction(post.id)"
            (mouseleave)="hideReaction(post.id)">

            <button mat-button>
              <mat-icon>{{ getReactionEmoji(post.id) }}</mat-icon>
              {{ getReactionLabel(post.id) }}
            </button>

            <div class="reactions-popup" *ngIf="isPopupVisible[post.id]">
              <div class="reaction" *ngFor="let react of reaction" (mouseenter)="hoveredReactions[post.id] = react"
                (mouseleave)="hoveredReactions[post.id] = null" (click)="selectReactions(post.id, react)">
                <span>{{ react.emoji }}</span>
              </div>
            </div>

          </div>

          <button mat-button (click)="openModal(post.images)">
            <mat-icon>chat_bubble_outline</mat-icon> Comment
          </button>

          <button mat-button>
            <mat-icon>repeat</mat-icon> Share
          </button>

          <button mat-button>
            <mat-icon>send</mat-icon> Send
          </button>
        </div>

        </div>
      </div>
    </mat-tab>

    <!-- Jobs Tab -->
    <mat-tab label="Jobs">
      <div class="tab-content">
        <mat-card-content>
          <section class="cv-section" *ngIf="profiles?.lines?.education?.length > 0">
            <mat-list *ngFor="let education of profiles.lines.education">
              <mat-list-item>Highest Education: {{ education.highest_education }}</mat-list-item>
              <mat-list-item>School Name: {{ education.school_name }}</mat-list-item>
              <mat-list-item>Start Month: {{ education.start_month }}</mat-list-item>
              <mat-list-item>Start Year: {{ education.start_year }}</mat-list-item>
              <mat-list-item>End Month: {{ education.end_month }}</mat-list-item>
              <mat-list-item>End Year: {{ education.end_year }}</mat-list-item>
            </mat-list>
          </section>
        </mat-card-content>
      </div>
    </mat-tab>

    <!-- People Tab -->
    <mat-tab label="People">
      <div class="tab-content">
        <mat-card-content>
          <section class="cv-section" *ngIf="profiles?.lines?.skills?.length > 0">
            <mat-list>
              <mat-list-item *ngFor="let skill of profiles.lines.skills">{{ skill.skills }}</mat-list-item>
            </mat-list>
          </section>
        </mat-card-content>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>