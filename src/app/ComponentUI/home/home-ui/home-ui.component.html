<div class="content-body">
  <!-- Left Sidebar -->
  <div class="left-sidebar">
    <!-- Skeleton Loader -->
    <ng-container *ngIf="isLoading">
      <mat-card class="post-box-container">

        <mat-card-title class="skeleton-line short"></mat-card-title>
        <mat-card-subtitle class="skeleton-line shorter"></mat-card-subtitle>
        <mat-card-title class="skeleton-line short"></mat-card-title>
        <mat-card-subtitle class="skeleton-line shorter"></mat-card-subtitle>

        <mat-card-content class="scrollable-content">
          <div class="button-gap">
            <div class="skeleton-btn small"></div>
            <div class="skeleton-btn small"></div>
          </div>
          <div class="button-gap">
            <div class="skeleton-btn small"></div>
            <div class="skeleton-btn small"></div>
          </div>
        </mat-card-content>
      </mat-card>
    </ng-container>

    <!-- Actual Profile Card -->
    <mat-card class="left-column" *ngIf="!isLoading && !isMobile">
      <div class="profile-avatar">
        <div class="avatar-container">
          <img *ngIf="profile_pic; else defaultAvatar" [src]="profile_pic.photo_pic" alt="Profile Picture"
            class="profile-pic" />
          <ng-template #defaultAvatar>
            <img src="assets/default-avatar.png" alt="Default Avatar" class="profile-pic" />
          </ng-template>

          <div class="edit-overlay" (click)="uploadPic()">
            <mat-icon>photo_camera</mat-icon>
          </div>
        </div>
        <p *ngIf="error" class="error-message">{{ error }}</p>
      </div>

      <!-- User Info -->
      <mat-card-title class="profile-name" *ngIf="showDefUserButtons">
        {{ profiles.fname }} {{ profiles.lname }}
      </mat-card-title>
      <mat-card-subtitle class="profile-profession" *ngIf="showDefUserButtons">
        {{ profiles.profession }}
      </mat-card-subtitle>

      <mat-card-title class="profile-name" *ngIf="showClientOrAdminButtons">
        {{ profiles.company }}
      </mat-card-title>
      <mat-card-subtitle class="profile-profession" *ngIf="showClientOrAdminButtons">
        {{ profiles.companywebsite }}
      </mat-card-subtitle>

      <mat-card-content class="scrollable-content">
        <!-- Buttons -->
        <div class="button-gap" *ngIf="showDefUserButtons">
          <button mat-button class="list-label" [routerLink]="['/profile/', currentUserCode]">
            <mat-icon>person</mat-icon> View Profile
          </button>
          <button mat-button class="list-label" (click)="printCV()">
            <mat-icon>description</mat-icon> View CV
          </button>
        </div>

        <div class="button-gap" *ngIf="showClientOrAdminButtons">
          <button mat-button class="list-label" [routerLink]="['/company_profile/', currentUserCode]">
            <mat-icon>person</mat-icon> View Profile
          </button>
          <button mat-button class="list-label">
            <mat-icon>description</mat-icon> View Jobs
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Middle Column -->
  <div class="middle-column" (scroll)="onScroll($event)" #middleColumn>
    <!-- Post Input -->
    <div class="post-top-container" *ngIf="!isLoading">
      <div class="input-section">
        <input type="text" placeholder="Create your post?" class="post-input" readonly (click)="createPost()" />
      </div>
      <div class="actions-section">
        <button class="action-btn live-video"><span class="icon">üé•</span> Photo</button>
        <button class="action-btn photo-video"><span class="icon">üì∑</span> Video</button>
        <button class="action-btn reel"><span class="icon">üéûÔ∏è</span> Events</button>
      </div>
    </div>

    <!-- Skeleton Posts -->
    <ng-container *ngIf="isLoading">
      <mat-card class="post-box-container" *ngFor="let item of skeletonPosts">
        <mat-card-header>
          <div class="skeleton-avatar"></div>
          <div class="skeleton-line short"></div>
          <div class="skeleton-line shorter"></div>
        </mat-card-header>
        <mat-card-content>
          <div class="skeleton-line"></div>
          <div class="skeleton-line medium"></div>
          <div class="skeleton-line short"></div>
        </mat-card-content>
        <mat-card-content class="skeleton-image"></mat-card-content>
        <mat-card-footer class="skeleton-footer">
          <div class="skeleton-btn small"></div>
          <div class="skeleton-btn small"></div>
          <div class="skeleton-btn small"></div>
        </mat-card-footer>
      </mat-card>
    </ng-container>

    <!-- Posts -->
    <mat-card *ngFor="let post of posts" class="post-box-container">
      <mat-card-header>
        <div mat-card-avatar class="avatar">
          <img [src]="post.profile_pic || 'assets/default.png'" alt="Avatar" />
        </div>
        <mat-card-title>
          <a class="user-name">{{ post.Fullname }}</a>
        </mat-card-title>
        <mat-card-subtitle>{{ post.created_at | date: 'medium' }}</mat-card-subtitle>

        <button mat-icon-button [matMenuTriggerFor]="menu">
          <mat-icon>more_horiz</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="onEditPost()">Edit</button>
          <button mat-menu-item (click)="onDelete(post)" [disabled]="isLoading">
            <ng-container *ngIf="!isLoading; else deletingTpl">Delete</ng-container>
            <ng-template #deletingTpl>
              <mat-progress-spinner diameter="20" mode="indeterminate" color="warn"></mat-progress-spinner>
            </ng-template>
          </button>
        </mat-menu>
      </mat-card-header>
      <br><br>
      <mat-card-content>
        <div class="content-wrapper" [class.expanded]="post.expanded">
          <p class="content-display">
            {{ post.expanded ? post.caption : (post.caption | slice:0:400) + '...' }}
          </p>
        </div>
        <a *ngIf="post.caption.length > 400" (click)="post.expanded = !post.expanded" class="see-more">
          {{ post.expanded ? 'See Less' : 'See More' }}
        </a>
      </mat-card-content>

      <!-- Images -->
      <mat-card-content class="post-images" *ngIf="post.images.length > 0">
        <div class="fb-gallery" [ngClass]="{ single: post.images.length === 1, multi: post.images.length > 1 }">
          <div class="gallery-item" *ngFor="let image of post.images.slice(0, maxImages); let i = index"
            (click)="openModal(post.images)">
            <img [src]="image.path_url" alt="Gallery image" />
            <div class="overlay" *ngIf="i === maxImages - 1 && post.images.length > maxImages">
              +{{ post.images.length - maxImages }}
            </div>
          </div>
        </div>
      </mat-card-content>

      <!-- Videos -->
      <div class="video-gallery" *ngFor="let video of post.videos?.slice(0, maxImages); let j = index" [ngClass]="{
          large: (post.images?.length + post.videos?.length) === 1 || j === 0
        }" (click)="openModal(post.videos)">
        <video controls [src]="video.path_url" width="100%" height="auto">
          Your browser does not support the video tag.
        </video>

        <div class="overlay" *ngIf="j === maxImages - 1 && post.videos?.length > maxImages">
          +{{ post.videos.length - maxImages }}
        </div>
      </div>

      <!-- Reaction Summary -->
      <div class="reactions-summary" *ngIf="totalReactionsCount > 0">
        <ng-container *ngFor="let reaction of reactionList; let i = index">
          <span class="emoji" [ngStyle]="{
              'z-index': 10 - i,
              'left.px': i * 12,
              position: 'relative',
              'font-size': '18px'
            }" [title]="reaction.reaction + ': ' + reaction.count">
            {{ reactionEmojiMap[reaction.reaction] || '‚ùì' }}
          </span>
        </ng-container>
        <a *ngIf="totalReactionsCount > 0" class="reaction-count-text">
          You and {{ totalReactionsCount - 1 }} others
        </a>
      </div>

      <!-- Footer -->
      <mat-card-footer>
        <!-- Like -->
        <div class="footer-btn like-button-wrapper" (mouseenter)="showReactionsFor = post.posts_uuid">
          <button mat-button (mouseenter)="togglePopup(post.posts_uuid, true)">
            <mat-icon>
              {{
              (postReactions[post.posts_uuid] &&
              postReactions[post.posts_uuid].hoveredReaction?.emoji) || 'thumb_up'
              }}
            </mat-icon>
            Like
          </button>
          <div class="reactions-popup" *ngIf="postReactions[post.posts_uuid]?.showPopup"
            (mouseleave)="togglePopup(post.posts_uuid, false)">
            <div class="reaction" *ngFor="let react of reactions"
              (mouseenter)="setHoveredReaction(post.posts_uuid, react)"
              (mouseleave)="setHoveredReaction(post.posts_uuid, null)" (click)="selectReaction(post.posts_uuid, react)">
              <span>{{ react.emoji }}</span>
            </div>
          </div>
        </div>

        <!-- Comment -->
        <div class="footer-btn">
          <button mat-button (click)="openModal(post.images)">
            <mat-icon>chat</mat-icon> Comment
          </button>
        </div>

        <!-- Repost -->
        <div class="footer-btn">
          <button mat-button>
            <mat-icon>repeat</mat-icon> Repost
          </button>
        </div>

        <!-- Send -->
        <div class="footer-btn">
          <button mat-button>
            <mat-icon>send</mat-icon> Send
          </button>
        </div>
      </mat-card-footer>
    </mat-card>
  </div>

  <!-- Right Sidebar -->
  <div class="right-column" *ngIf="!isMobile">
    <mat-card-header>
      <mat-card-title>Suggested History</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <!-- Skeleton Users -->
      <ng-container *ngIf="isLoading">
        <div *ngFor="let item of skeletonUsers" class="client-item skeleton-user">
          <div class="skeleton-avatar"></div>
          <div class="skeleton-info">
            <div class="skeleton-line short"></div>
            <div class="skeleton-line shorter"></div>
          </div>
          <div class="skeleton-btn small"></div>
        </div>
      </ng-container>

      <!-- User Suggestions -->
      <div *ngIf="!isLoading && users && users.length > 0; else noData">
        <div *ngFor="let user of users" class="client-item">
          <img [src]="user.photo_pic || 'assets/default-avatar.png'" alt="{{ user.fullname }}" class="client-photo" />

          <div class="client-info">
            <h3>
              <a [routerLink]="['/profile', user.code]" class="custom-title">
                {{ user.fullname }}
              </a>
            </h3>
            <p>{{ user.profession }}</p>
          </div>

          <!-- <div class="client-action">
            <button
              mat-flat-button
              [color]="
                user.follow_status === 'accepted'
                  ? 'accent'
                  : user.follow_status === 'pending'
                  ? 'warn'
                  : 'primary'
              "
              *ngIf="currentUserCode !== user.code"
              (click)="AddConnect(user.code, user.fullname, user.follow_status, user.id)"
            >
              <mat-icon *ngIf="user.follow_status === 'not_following'">person_add</mat-icon>
              <mat-icon *ngIf="user.follow_status === 'pending'" class="hourglass-animated">
                hourglass_top
              </mat-icon>
              <mat-icon *ngIf="user.follow_status === 'accepted'">check_circle</mat-icon>

              <ng-container [ngSwitch]="user.follow_status">
                <span *ngSwitchCase="'not_following'">Connect</span>
                <span *ngSwitchCase="'pending'">Pending</span>
                <span *ngSwitchCase="'accepted'">Connected</span>
              </ng-container>
            </button>
          </div> -->

          <div class="client-action">
            <button mat-flat-button [color]="
      user.follow_status === 'accepted'
        ? 'accent'
        : user.follow_status === 'pending'
        ? 'warn'
        : 'primary'
    " *ngIf="currentUserCode !== user.code"
              (click)="AddConnect(user.code, user.fullname, user.follow_status, user.id)">
              <!-- Icons -->
              <mat-icon *ngIf="user.follow_status === 'not_following'">person_add</mat-icon>
              <mat-icon *ngIf="user.follow_status === 'pending'" class="hourglass-animated">
                hourglass_top
              </mat-icon>
              <mat-icon *ngIf="user.follow_status === 'accepted'">check_circle</mat-icon>

              <!-- Labels -->
              <span class="btn-label" *ngIf="user.follow_status === 'not_following'">Connect</span>
              <span class="btn-label" *ngIf="user.follow_status === 'pending'">Pending</span>
              <span class="btn-label" *ngIf="user.follow_status === 'accepted'">Connected</span>
            </button>
          </div>

        </div>
      </div>

      <!-- No Data -->
      <ng-template #noData>
        <p class="no-data-text" *ngIf="!isLoading">No suggested history available.</p>
      </ng-template>
    </mat-card-content>
    <div class="spacer-top"></div>
  </div>

   <button class="scroll-to-top" *ngIf="showScrollTop" (click)="scrollToTop()">
    <mat-icon>arrow_upward</mat-icon>
  </button>
</div>