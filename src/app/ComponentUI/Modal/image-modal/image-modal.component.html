<button mat-icon-button class="close-button" [mat-dialog-close]="true">
  <mat-icon class="close-icon" color="warn">close</mat-icon>
</button>

<div class="modal-container">
  <mat-card class="card">
    <!-- Center Image -->
    <mat-progress-bar *ngIf="isLoading" mode="indeterminate" color="primary"></mat-progress-bar>
    <div class="modal-content">
      <div #carousel id="carouselExample" class="carousel slide" data-bs-interval="3000">
        <div class="carousel-inner">
          <div
            class="carousel-item"
            *ngFor="let post of posts; let i = index"
            [attr.data-index]="i"
            [class.active]="i === currentIndex">
            
            <!-- IMAGES -->
            <ng-container *ngIf="post.posts_type === 'image'">
              <img [src]="post.path_url" class="d-block w-100" alt="Preview Image">
            </ng-container>

              <!-- VIDEO -->
            <ng-container *ngIf="post.posts_type === 'video'">
              <video class="d-block w-100" controls preload="metadata">
                <source [src]="post.path_url" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </ng-container>

          </div>
        
        </div>
        <button *ngIf="posts.length > 1" class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        </button>
        <button *ngIf="posts.length > 1" class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
        </button>
      </div>
    </div>
    
  </mat-card>


    <div class="comment-section">
          <!-- Reactions Display -->
        <div class="reactions-summary">
          <ng-container *ngFor="let reaction of displayedReactions">
            <span class="emoji" [ngStyle]="{ 'z-index': 10 - reaction.index, 'left.px': reaction.index * 12 }">
              {{ reactionEmojiMap[reaction.name] }}
            </span>
          </ng-container>
        <a *ngIf="totalReactionsCount > 0" 
          (click)="openReactionsModal()" 
          style="cursor: pointer; color: blue; text-decoration: underline;">
          You and {{ totalReactionsCount - 1 }} others
        </a>
      
        </div>

      <mat-card-actions class="interaction-buttons">
        <div class="like-button-wrapper" (mouseenter)="showReactions = true" (mouseenter)="showReactions = true">
          <button mat-button color="primary">
            <mat-icon *ngIf="!hoveredReaction">{{ selectedReaction?.emoji || 'thumb_up' }}</mat-icon>
            <mat-icon *ngIf="hoveredReaction">{{ hoveredReaction.emoji }}</mat-icon>
          </button>
      
          <div class="reactions-popup" *ngIf="showReactions">
            <div class="reaction"  *ngFor="let react of reactions" (mouseenter)="hoveredReaction = react" (click)="selectReaction(react)">
              <span>{{ react.emoji }}</span>
            </div>
          </div>
        </div>

        <button mat-button color="primary">
          <mat-icon>repeat</mat-icon> Repost
        </button>
        <button mat-button color="primary">
          <mat-icon>send</mat-icon> Send
        </button>
      </mat-card-actions>
     
    <div class="form-row">
      <mat-form-field class="form-field" appearance="standard">
        <input matInput placeholder="Write a comment..." [(ngModel)]="newComment">
      </mat-form-field>
      
      <button mat-button color="primary" (click)="addComment()">
        <mat-icon>chat</mat-icon> Comment
      </button>
      
      <mat-progress-bar *ngIf="isSubmitting" mode="indeterminate" color="primary"></mat-progress-bar>
      
    </div>

      <div class="comments-container">
        <div *ngFor="let comment of comments" class="comment">
          <img [src]="comment.profile_pic || 'assets/images/default.png'" alt="User" class="comment-avatar">
         
          <div class="comment-content">
            <strong>{{ comment.fullname }}</strong>
           
            <!-- edit comment by usercode -->
            <button *ngIf="currentUserCode == comment.code"
                  mat-icon-button
                 class="action-button" color="primary"
                  (click)="editComment(comment)">
            <mat-icon>edit</mat-icon>
          </button>

            <p>{{ comment.comment }} </p>
            <small>{{ comment.date_comment }}</small>
           
            <div class="comment-actions" *ngIf="comment">
              <button mat-button (click)="likeComment(comment)">Like</button>
              <span>{{ comment.likes || 0 }} Like{{ comment.likes === 1 ? '' : 's' }}</span>
              <button mat-button (click)="comment.showReply = !comment.showReply">Reply</button>
            </div>
      
           <!--public edit comment by usercode -->
            <div *ngIf="comment.isEditing">
              <mat-form-field class="form-field" appearance="standard">
                <input matInput [(ngModel)]="comment.comment" (keyup.enter)="editHeadersComment(comment, comment.comment_uuid)">
              </mat-form-field>
              <button mat-icon-button color="primary" (click)="editHeadersComment(comment, comment.comment_uuid)">
                <mat-icon>check</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="cancelReplyEdit(comment)">
                <mat-icon>close</mat-icon>
              </button>
            </div>

            <div *ngIf="comment.showReply" class="reply-input">
              <mat-form-field class="form-field" appearance="standard">
                <input matInput placeholder="Write a reply..."
                      [(ngModel)]="comment.newReply"
                      [disabled]="comment.isSubmitting"
                      (keyup.enter)="addReply(comment)">
              </mat-form-field>
      
              <button mat-icon-button color="primary"
                  (click)="addReply(comment)"
                  [disabled]="!comment.newReply?.trim() || comment.isSubmitting">
                  <mat-icon>send</mat-icon>
              </button>
            </div>
      
            <mat-progress-bar *ngIf="comment.isSubmitting" mode="indeterminate" color="primary"></mat-progress-bar>
      
            <div class="replies" *ngIf="comment.replies?.length">
              <div *ngFor="let reply of comment.replies" class="comment reply">
                <img [src]="reply.profile_pic || 'assets/images/default.png'" alt="User" class="comment-avatar">
                <div class="comment-content">
                  <strong>{{ reply.fullname }}</strong>
                    <!-- reply edit comment by usercode -->
                      <button *ngIf="currentUserCode == reply.code" color="primary"
                            mat-icon-button
                            class="action-button"
                            (click)="replyeditComment(reply)">
                      <mat-icon>edit</mat-icon>
                    </button>
                  <p>{{ reply.comment }}</p>
                  <small>{{ reply.date_comment }}</small>
             
                    <div *ngIf="reply.isEditing">
                      <mat-form-field class="form-field" appearance="standard">
                        <input matInput [(ngModel)]="reply.comment" (keyup.enter)="saveReplyEdit(reply, reply.id)">
                      </mat-form-field>
                          <div class="reply-edit-actions">
                              <button mat-icon-button color="primary" (click)="saveReplyEdit(reply, reply.id)">
                                <mat-icon>check</mat-icon>
                              </button>
                              <button mat-icon-button color="warn" (click)="cancelReplyEdit(reply)">
                                <mat-icon>close</mat-icon>
                              </button>
                              <button mat-icon-button color="warn" (click)="cancelReplyEdit(reply)">
                                <mat-icon>delete</mat-icon>
                              </button>

                          </div>
                    </div>
                  </div>
                </div>
              </div>
        
          </div>
        </div>
      </div>
 </div>
      
      
      



  <!-- <button mat-icon-button [matMenuTriggerFor]="menu"  [disabled]="isLoading">
    <mat-icon>more_horiz</mat-icon>
  </button> -->

  <!-- <mat-menu #menu="matMenu">
     <button mat-menu-item [disabled]="isLoading"><mat-icon color="primary">edit</mat-icon>
      <span>Edit</span></button> 
    <button mat-menu-item (click)="deleteImage(posts.posts_uuind)" [disabled]="isLoading"> 
      <mat-icon color="warn">delete</mat-icon>
      <span>Delete</span>
    </button>
  </mat-menu> -->



